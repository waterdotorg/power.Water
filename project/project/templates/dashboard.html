{% extends "base.html" %}
{% load humanize %}
{% load markup %}
{% load thumbnail %}

{% block body_class %}dashboard{% endblock %}

{% block top %}
    {{ block.super }}
    {% include "fragments/settings_form_success.html" %}
    {% include "fragments/settings_form.html" %}

    {% if user.is_authenticated and not user.email %}
      <!-- Email Form -->
      <div id="ajax-form" class="alert-ajax" style="display:none;">
        <div class="container relative">
            <form id="email-form" class="form-inline" method="POST" action="{% url ajax_email_form %}">{% csrf_token %}
                <div class="control-group">
                    <label class="control-label" for="inputIcon">Thanks for connecting! Please provide us with a valid email address:</label>
                    <div class="input-append">
                       <input id="email" name="email" size="16" type="text" placeholder="email@domain">
                       <input class="btn" type="submit" id="submit-email" value="Submit">
                    </div>
                </div>
            </form>
            <a class="close" href="#">&times;</a>
        </div>
      </div>
    {% endif %}
{% endblock %}

{% block main %}
  <!-- Thanks Block -->
  <div id="thanks-block">
    <div class="container">
      <div class="row-fluid">

        <div class="span5">
          <h1 class="thanks-heading">Thanks!</h1>
        </div>

        <div id="dashboard-user-img" class="span2">
          {% if profile.image %}
            <img src="{% thumbnail profile.image 140x140 crop %}" alt="{{ profile.user.get_full_name }}" />
            <!-- <img src="{{ STATIC_URL }}image/avatar.png" width="140" height="140" /> -->
          {% else %}
            <img src="{{ STATIC_URL }}image/avatar.png" width="140" height="140" />
          {% endif %}
        </div>

        <div class="span5">
          <h4 class="thanks-text">
            <span>{{ user.first_name }},</span> Your signup was successful! Thanks for your support.
          </h4>
        </div>

      </div>
    </div>
  </div>

  <!-- Next Block -->
  <div id="next-block" class="backg">
    <div class="container">
      <div class="row-fluid">

        <div class="span4">
          <img class="next-image" src="{{ STATIC_URL }}image/dashboard_well.jpg" />
        </div>

        <div class="span7 offset1">
          <h2 class="next-heading">What's Next?</h2>
          <p class="next-text">
          Nothing, you're all set. Remember you can come back to this site and
          manage your settings whenever you like and we'll do a post on your
          account shortly. Ending the water crisis in our lifetime isn't
          something one person can do on their own. Water.org is grateful
          you've joined us to make a difference.
          </p>
          <!-- <div class="join-button join-twitter">
              <a id="trackTwitterInvite" class="next-tweet" href="#">
                  Tweet&nbsp;to&nbsp;invite&nbsp;friends&nbsp;<span class="icon-twitter" data-text="twitter"></span>
              </a>
          </div> -->

          {% include "fragments/next_buttons.html" %}

        </div>
      </div>
    </div>
  </div>


  <div class="blue-stripe">
    <div class="container">
        <p><span class="icon-camera-retro instagram-icon"></span>&nbsp;&nbsp;Show your support on Instagram by using the hashtag <span class="instagram-hash">#water</span>
    </div>
  </div>
  <div class="row-fluid instagram-background backg">
      <div class="span12">
          <ul class="instagram clearfix">
              {% for image in instagram_images %}
              <li id="{{ image.instagram_id }}" class="instagram-placeholder">
                  <a target="_blank" href="{{ image.link }}">
                    <img class="instagram-image" src="{{ image.thumbnail_url }}" />
                  </a>
              </li>
              {% endfor %}
          </ul>
      </div>
  </div>
{% endblock %}

{% block footer_scripts %}
  {% if user.is_authenticated and not user.email %}
    <!-- Initiate Ajax Email Form -->
    <script>
        $(window).load(function() {
            setTimeout(ajaxFormShow, 500);
        });
    </script>

    <!-- Validate and Post Email Form -->
    <script>
        $(document).on("submit", "#email-form", function(e) {
            clear_form_field_errors($("#ajax-form"));
            e.preventDefault();
            var self = $(this),
                url = self.attr("action"),
                ajax_req = $.ajax({
                    url: url,
                    type: "POST",
                    data: {
                        email: self.find("#email").val(),
                        csrfmiddlewaretoken: self.find("input[name='csrfmiddlewaretoken']").val()
                    },
                    success: function(data, textStatus, jqXHR) {
                        $("#ajax-form").slideUp("medium");
                        showSuccess();
                    },
                    error: function(data, textStatus, jqXHR) {
                        var errors = $.parseJSON(data.responseText);
                        $.each(errors, function(index, value) {
                            if (index === "__all__") {
                                django_message(value[0], "error");
                            } else {
                                apply_form_field_error(index, value);
                            }
                        });
                    }
                });
        });
    </script>
  {% endif %}
{% endblock %}
